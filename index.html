<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Endulzate - Tu Recetario Personal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style id="app-style">
    :root {
      --primary: #F8BBD0;
      --secondary: #B3E5FC;
      --accent: #FFCC80;
      --text: #4A4A4A;
      --light-bg: #FFF8F8;
    }

    body {
      font-family: 'Quicksand', sans-serif;
      background-color: var(--light-bg);
      color: var(--text);
    }

    .btn {
      border-radius: 20px;
      padding: 0.5rem 1.2rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background-color: var(--primary);
      color: #6A4046;
      border: none;
    }

    .btn-primary:hover {
      background-color: #F48FB1;
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .btn-secondary {
      background-color: var(--secondary);
      color: #01579B;
      border: none;
    }

    .btn-secondary:hover {
      background-color: #81D4FA;
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .card {
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    .nav-tab {
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      border-radius: 12px 12px 0 0;
      transition: all 0.2s ease;
    }

    .nav-tab.active {
      background-color: white;
      color: var(--text);
      box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.05);
    }

    .nav-tab:not(.active):hover {
      background-color: rgba(255, 255, 255, 0.6);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .recipe-card {
      background: white;
      border-radius: 16px;
      overflow: hidden;
    }

    .recipe-thumb {
      height: 180px;
      object-fit: cover;
    }

    .gallery-item {
      border-radius: 12px;
      overflow: hidden;
    }

    .gallery-thumb {
      height: 200px;
      object-fit: cover;
      transition: transform 0.4s ease;
    }

    .gallery-item:hover .gallery-thumb {
      transform: scale(1.05);
    }

    .modal {
      position: fixed;
      z-index: 50;
      left: 0; right: 0; top: 0; bottom: 0;
      background: rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .modal.show {
      opacity: 1;
      pointer-events: auto;
    }

    .modal-content {
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 2px 24px rgba(0,0,0,0.15);
      overflow: hidden;
    }

    .badge {
      display: inline-block;
      padding: 0.25em 0.6em;
      font-size: 0.75em;
      font-weight: 600;
      border-radius: 0.5em;
      margin-right: 0.25em;
    }
    .badge-primary {
      background: #ec4899;
      color: #fff;
    }

    .wishlist-item {
      border-radius: 12px;
      background-color: white;
    }

    .wishlist-checkbox {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid var(--primary);
      appearance: none;
      cursor: pointer;
      position: relative;
      transition: all 0.2s;
    }

    .wishlist-checkbox:checked {
      background-color: var(--primary);
    }

    .wishlist-checkbox:checked:after {
      content: '✓';
      position: absolute;
      color: white;
      font-size: 12px;
      left: 4px;
      top: -2px;
    }

    .completed-item {
      text-decoration: line-through;
      color: #9ca3af; /* gray-400 */
    }

    .toggle-animation {
      transition: transform 0.3s ease;
    }
    
    .rotate-180 {
      transform: rotate(180deg);
    }

    /* Responsive styles */
    @media (max-width: 768px) {
      .nav-tab {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
      }
      
      .recipe-thumb, .gallery-thumb {
        height: 140px;
      }
    }

    /* 1. Ingredient amount controls */
    .ingredient-amount-container {
      display: flex;
      align-items: center;
    }
    .decrease-amount, .increase-amount {
      background: #f3f4f6; /* gray-100 */
      border: 1px solid #e5e7eb; /* gray-200 */
      border-radius: 0.5rem;
      padding: 0.25rem 0.5rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .decrease-amount {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }
    .increase-amount {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
    .ingredient-amount {
      width: 4rem;
      text-align: center;
      border-left: none;
      border-right: none;
    }
</style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- Header Section -->
  <header class="bg-white px-4 py-3 shadow-sm">
    <div class="container mx-auto flex justify-between items-center">
      <div class="flex items-center gap-3">
        <h1 class="text-xl md:text-2xl font-bold" style="color: #F06292;">Endulzate</h1>
      </div>
      <div class="flex items-center gap-2">
        <button id="darkModeToggle" class="p-2 rounded-full hover:bg-gray-100">
          <i class="fas fa-moon"></i>
        </button>
        <button id="saveAllDataBtn" class="btn btn-primary flex items-center gap-2">
          <i class="fas fa-save"></i>
          <span class="hidden md:inline">Guardar Cambios</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Navigation Tabs -->
  <nav class="bg-gray-100 px-4 pt-2">
    <div class="container mx-auto">
      <div class="flex gap-1">
        <button class="nav-tab active" data-tab="recipes">
          <i class="fas fa-book-open mr-2"></i>
          <span class="hidden md:inline">Recetario</span>
        </button>
        <button class="nav-tab" data-tab="gallery">
          <i class="fas fa-images mr-2"></i>
          <span class="hidden md:inline">Galería</span>
        </button>
        <button class="nav-tab" data-tab="wishlist">
          <i class="fas fa-heart mr-2"></i>
          <span class="hidden md:inline">Lista de Deseos</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- Main Content Area -->
  <main class="flex-grow container mx-auto p-4">
    <!-- Recipes Tab Content -->
    <section id="recipes-content" class="tab-content active">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">Mi Recetario Personal</h2>
        <button id="addRecipeBtn" class="btn btn-primary flex items-center gap-2">
          <i class="fas fa-plus"></i>
          <span>Nueva Receta</span>
        </button>
      </div>
      
      <!-- Search and Filter Section -->
      <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
        <div class="flex flex-col md:flex-row gap-4">
          <div class="flex-grow">
            <div class="relative">
              <input type="text" id="recipeSearch" placeholder="Buscar por nombre o ingrediente..." 
                class="w-full px-4 py-2 border border-gray-200 rounded-full focus:outline-none focus:border-pink-300 pl-10">
              <i class="fas fa-search absolute left-4 top-3 text-gray-400"></i>
            </div>
          </div>
          <div class="flex gap-2">
            <select id="categoryFilter" class="px-4 py-2 border border-gray-200 rounded-full focus:outline-none focus:border-pink-300">
              <option value="">Todas las categorías</option>
              <option value="postres">Postres</option>
              <option value="panes">Panes</option>
              <option value="galletas">Galletas</option>
              <option value="tartas">Tartas</option>
            </select>
            <button id="advancedFiltersBtn" class="btn btn-secondary flex items-center gap-2">
              <i class="fas fa-filter"></i>
              <span class="hidden md:inline">Filtros</span>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Recipes Grid -->
      <div id="recipesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Sample recipes will be loaded here -->
      </div>
    </section>

    <!-- Gallery Tab Content -->
    <section id="gallery-content" class="tab-content">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">Galería de Fotos</h2>
        <button id="addPhotoBtn" class="btn btn-primary flex items-center gap-2">
          <i class="fas fa-plus"></i>
          <span>Añadir Foto</span>
        </button>
      </div>
      
      <!-- Gallery Filter -->
      <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
        <div class="flex gap-4">
          <div class="flex-grow">
            <input type="text" id="gallerySearch" placeholder="Buscar por título..." 
              class="w-full px-4 py-2 border border-gray-200 rounded-full focus:outline-none focus:border-pink-300">
          </div>
          <select id="gallerySortBy" class="px-4 py-2 border border-gray-200 rounded-full focus:outline-none focus:border-pink-300">
            <option value="date-desc">Más recientes primero</option>
            <option value="date-asc">Más antiguas primero</option>
            <option value="title-asc">Título (A-Z)</option>
            <option value="title-desc">Título (Z-A)</option>
          </select>
        </div>
      </div>
      
      <!-- Gallery Grid -->
      <div id="galleryGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
        <!-- Sample gallery items will be loaded here -->
      </div>
    </section>

    <!-- Wishlist Tab Content -->
    <section id="wishlist-content" class="tab-content">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">Lista de Deseos</h2>
        <button id="addWishBtn" class="btn btn-primary flex items-center gap-2">
          <i class="fas fa-plus"></i>
          <span>Nuevo Deseo</span>
        </button>
      </div>
      
      <!-- Wishlist Categories -->
      <div class="space-y-6">
        <!-- Para cocinar pronto -->
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
          <div class="p-4 bg-pink-50 flex justify-between items-center cursor-pointer" data-toggle="wishlist-cook">
            <h3 class="text-lg font-bold text-pink-700">
              <i class="fas fa-utensils mr-2"></i>
              Para cocinar pronto
            </h3>
            <i class="fas fa-chevron-down toggle-animation"></i>
          </div>
          <div id="wishlist-cook" class="p-4 space-y-3">
            <div class="wishlist-item p-3 flex items-center gap-3">
              <input type="checkbox" class="wishlist-checkbox">
              <div>
                <h4 class="font-medium">Macarons de Frambuesa</h4>
                <p class="text-sm text-gray-500">Necesito perfeccionar la técnica del merengue francés</p>
              </div>
            </div>
            <div class="wishlist-item p-3 flex items-center gap-3">
              <input type="checkbox" class="wishlist-checkbox" checked>
              <div class="completed-item">
                <h4 class="font-medium">Donas Glaseadas</h4>
                <p class="text-sm text-gray-500">Usar aceite a temperatura correcta</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Para buscar en restaurante -->
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
          <div class="p-4 bg-blue-50 flex justify-between items-center cursor-pointer" data-toggle="wishlist-restaurant">
            <h3 class="text-lg font-bold text-blue-700">
              <i class="fas fa-store mr-2"></i>
              Para buscar en restaurante
            </h3>
            <i class="fas fa-chevron-down toggle-animation"></i>
          </div>
          <div id="wishlist-restaurant" class="p-4 space-y-3">
            <div class="wishlist-item p-3 flex items-center gap-3">
              <input type="checkbox" class="wishlist-checkbox">
              <div>
                <h4 class="font-medium">Tiramisú Auténtico Italiano</h4>
                <p class="text-sm text-gray-500">Ir a Dolce Vita en el centro</p>
              </div>
            </div>
            <div class="wishlist-item p-3 flex items-center gap-3">
              <input type="checkbox" class="wishlist-checkbox">
              <div>
                <h4 class="font-medium">Cheesecake Japonés</h4>
                <p class="text-sm text-gray-500">Recomendaron el café Sakura</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Pendientes por ingredientes -->
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
          <div class="p-4 bg-amber-50 flex justify-between items-center cursor-pointer" data-toggle="wishlist-ingredients">
            <h3 class="text-lg font-bold text-amber-700">
              <i class="fas fa-shopping-basket mr-2"></i>
              Pendientes por ingredientes
            </h3>
            <i class="fas fa-chevron-down toggle-animation"></i>
          </div>
          <div id="wishlist-ingredients" class="p-4 space-y-3">
            <div class="wishlist-item p-3 flex items-center gap-3">
              <input type="checkbox" class="wishlist-checkbox">
              <div>
                <h4 class="font-medium">Macarons de Pistache</h4>
                <p class="text-sm text-gray-500">Necesito pistaches crudos y colorante alimentario verde</p>
              </div>
            </div>
            <div class="wishlist-item p-3 flex items-center gap-3">
              <input type="checkbox" class="wishlist-checkbox">
              <div>
                <h4 class="font-medium">Tarta de Frutas Exóticas</h4>
                <p class="text-sm text-gray-500">Buscar pitahaya y maracuyá</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modals -->
  <!-- Recipe Form Modal -->
  <div id="recipeFormModal" class="modal">
    <div class="modal-content w-full max-w-3xl p-6">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold" id="recipeFormTitle">Nueva Receta</h3>
        <button class="close-modal text-gray-500 hover:text-gray-700">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <form id="recipeForm" class="space-y-4">
        <input type="hidden" id="recipeId">
        
        <div>
          <label for="recipeName" class="block text-gray-700 mb-1 font-medium">Nombre de la Receta</label>
          <input type="text" id="recipeName" required class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300">
        </div>
        
        <div>
          <label for="recipeCategory" class="block text-gray-700 mb-1 font-medium">Categorías (separadas por comas)</label>
          <input type="text" id="recipeCategory" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300"
            placeholder="Postres, merienda, bebida, fresco">
        </div>
        
        <div>
          <label for="recipeDescription" class="block text-gray-700 mb-1 font-medium">Descripción Breve</label>
          <textarea id="recipeDescription" rows="2" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300"></textarea>
        </div>
        
        <div>
          <label class="block text-gray-700 mb-1 font-medium">Tiempo de Preparación</label>
          <div class="flex items-center mb-2">
            <input type="radio" id="exactTimeOption" name="timeType" value="exact" checked class="mr-2">
            <label for="exactTimeOption">Tiempo exacto</label>
            <input type="radio" id="rangeTimeOption" name="timeType" value="range" class="ml-6 mr-2">
            <label for="rangeTimeOption">Intervalo de tiempo</label>
          </div>
          
          <div id="exactTimeContainer" class="flex items-center">
            <input type="number" id="recipeTime" min="1" class="w-20 px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300">
            <span class="mx-2">minutos</span>
          </div>
          
          <div id="rangeTimeContainer" class="flex items-center hidden">
            <input type="number" id="recipeTimeMin" min="1" class="w-20 px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300">
            <span class="mx-2">a</span>
            <input type="number" id="recipeTimeMax" min="1" class="w-20 px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300">
            <span class="mx-2">minutos</span>
          </div>
        </div>
        
        <div>
          <label for="recipeImage" class="block text-gray-700 mb-1 font-medium">Imagen (URL)</label>
          <input type="url" id="recipeImage" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300" 
            placeholder="https://ejemplo.com/imagen.jpg">
        </div>
        
        <div>
          <label class="block text-gray-700 mb-1 font-medium">Ingredientes</label>
          <div id="ingredientsList" class="space-y-2 mb-2">
            <div class="ingredient-item flex gap-2">
              <input type="text" class="ingredient-name flex-grow px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300" 
                placeholder="Ingrediente">
              <div class="ingredient-amount-container flex items-center">
                <button type="button" class="decrease-amount px-2 py-1 bg-gray-100 rounded-l-lg border border-gray-200">
                  <i class="fas fa-minus"></i>
                </button>
                <input type="number" min="0" step="1" class="ingredient-amount w-16 px-2 py-2 border-y border-gray-200 text-center focus:outline-none focus:border-pink-300" 
                  placeholder="Cant." value="1">
                <button type="button" class="increase-amount px-2 py-1 bg-gray-100 rounded-r-lg border border-gray-200">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
              <select class="ingredient-unit px-2 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300">
                <option value="g">g</option>
                <option value="ml">ml</option>
                <option value="cda">cda</option>
                <option value="cdta">cdta</option>
                <option value="unidades">unidades</option>
                <option value="tazas">tazas</option>
                <option value="pizca">pizca</option>
              </select>
              <button type="button" class="remove-ingredient text-red-500 hover:text-red-700">
                <i class="fas fa-times-circle"></i>
              </button>
            </div>
          </div>
          <button type="button" id="addIngredientBtn" class="text-pink-500 hover:text-pink-700">
            <i class="fas fa-plus-circle mr-1"></i> Añadir ingrediente
          </button>
        </div>
        
        <div>
          <label class="block text-gray-700 mb-1 font-medium">Pasos</label>
          <div id="stepsList" class="space-y-2 mb-2">
            <div class="step-item flex gap-2">
              <span class="step-number w-8 h-8 bg-pink-100 rounded-full flex items-center justify-center text-pink-700 font-medium">1</span>
              <textarea class="step-description flex-grow px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300" 
                placeholder="Instrucción" rows="2"></textarea>
            </div>
          </div>
          <button type="button" id="addStepBtn" class="text-pink-500 hover:text-pink-700">
            <i class="fas fa-plus-circle mr-1"></i> Añadir paso
          </button>
        </div>
        
        <div class="flex justify-end gap-3 pt-4">
          <button type="button" class="btn bg-gray-200 text-gray-700 hover:bg-gray-300 close-modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar Receta</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Photo Form Modal -->
  <div id="photoFormModal" class="modal">
    <div class="modal-content w-full max-w-xl p-6">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold">Añadir Foto</h3>
        <button class="close-modal text-gray-500 hover:text-gray-700">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <form id="photoForm" class="space-y-4">
        <div>
          <label for="photoTitle" class="block text-gray-700 mb-1 font-medium">Título</label>
          <input type="text" id="photoTitle" required class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300">
        </div>
        <div>
          <label for="photoDescription" class="block text-gray-700 mb-1 font-medium">Descripción</label>
          <textarea id="photoDescription" rows="3" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300"></textarea>
        </div>
        <div>
          <label for="photoURL" class="block text-gray-700 mb-1 font-medium">URL de la Imagen</label>
          <input type="url" id="photoURL" required class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300"
            placeholder="https://ejemplo.com/imagen.jpg">
        </div>
        <div class="flex justify-end gap-3 pt-4">
          <button type="button" class="btn bg-gray-200 text-gray-700 hover:bg-gray-300 close-modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar Foto</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Wishlist Form Modal -->
  <div id="wishFormModal" class="modal">
    <div class="modal-content w-full max-w-md p-6">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold">Nuevo Deseo</h3>
        <button class="close-modal text-gray-500 hover:text-gray-700">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <form id="wishForm" class="space-y-4">
        <div>
          <label for="wishCategory" class="block text-gray-700 mb-1 font-medium">Categoría</label>
          <select id="wishCategory" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300">
            <option value="cook">Para cocinar pronto</option>
            <option value="restaurant">Para buscar en restaurante</option>
            <option value="ingredients">Pendientes por ingredientes</option>
          </select>
        </div>
        <div>
          <label for="wishTitle" class="block text-gray-700 mb-1 font-medium">Título</label>
          <input type="text" id="wishTitle" required class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300">
        </div>
        <div>
          <label for="wishNotes" class="block text-gray-700 mb-1 font-medium">Notas</label>
          <textarea id="wishNotes" rows="2" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300"></textarea>
        </div>
        <div class="flex justify-end gap-3 pt-4">
          <button type="button" class="btn bg-gray-200 text-gray-700 hover:bg-gray-300 close-modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar Deseo</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Vista simplificada de receta (modal) -->
  <div id="recipeViewModal" class="modal">
    <div class="modal-content w-full max-w-lg p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold" id="recipeViewTitle"></h3>
        <button class="close-modal text-gray-500 hover:text-gray-700"><i class="fas fa-times text-xl"></i></button>
      </div>
      <div id="recipeViewBody"></div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Data storage
      let recipes = JSON.parse(localStorage.getItem('recipes')) || [];
      let gallery = JSON.parse(localStorage.getItem('gallery')) || [];
      let wishlist = JSON.parse(localStorage.getItem('wishlist')) || {
        cook: [],
        restaurant: [],
        ingredients: []
      };
      
      // Tab navigation
      const tabButtons = document.querySelectorAll('.nav-tab');
      const tabContents = document.querySelectorAll('.tab-content');
      
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          const tabName = button.getAttribute('data-tab');
          
          // Update active states
          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabContents.forEach(content => content.classList.remove('active'));
          
          button.classList.add('active');
          document.getElementById(`${tabName}-content`).classList.add('active');
        });
      });
      
      // Recipe functionality
      const recipesGrid = document.getElementById('recipesGrid');
      const addRecipeBtn = document.getElementById('addRecipeBtn');
      const recipeFormModal = document.getElementById('recipeFormModal');
      const recipeForm = document.getElementById('recipeForm');
      const closeModalButtons = document.querySelectorAll('.close-modal');
      
      // Time input toggle
      const exactTimeOption = document.getElementById('exactTimeOption');
      const rangeTimeOption = document.getElementById('rangeTimeOption');
      const exactTimeContainer = document.getElementById('exactTimeContainer');
      const rangeTimeContainer = document.getElementById('rangeTimeContainer');
      
      exactTimeOption.addEventListener('change', function() {
        if (this.checked) {
          exactTimeContainer.classList.remove('hidden');
          rangeTimeContainer.classList.add('hidden');
        }
      });
      
      rangeTimeOption.addEventListener('change', function() {
        if (this.checked) {
          exactTimeContainer.classList.add('hidden');
          rangeTimeContainer.classList.remove('hidden');
        }
      });
      
      // Add recipe
      addRecipeBtn.addEventListener('click', () => {
        document.getElementById('recipeFormTitle').textContent = 'Nueva Receta';
        recipeForm.reset();
        document.getElementById('recipeId').value = '';
        
        // Reset ingredients and steps
        document.getElementById('ingredientsList').innerHTML = `
          <div class="ingredient-item flex gap-2">
            <input type="text" class="ingredient-name flex-grow px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300" 
              placeholder="Ingrediente">
            <div class="ingredient-amount-container flex items-center">
              <button type="button" class="decrease-amount px-2 py-1 bg-gray-100 rounded-l-lg border border-gray-200">
                <i class="fas fa-minus"></i>
              </button>
              <input type="number" min="0" step="1" class="ingredient-amount w-16 px-2 py-2 border-y border-gray-200 text-center focus:outline-none focus:border-pink-300" 
                placeholder="Cant." value="1">
              <button type="button" class="increase-amount px-2 py-1 bg-gray-100 rounded-r-lg border border-gray-200">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <select class="ingredient-unit px-2 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300">
              <option value="g">g</option>
              <option value="ml">ml</option>
              <option value="cda">cda</option>
              <option value="cdta">cdta</option>
              <option value="unidades">unidades</option>
              <option value="tazas">tazas</option>
              <option value="pizca">pizca</option>
            </select>
            <button type="button" class="remove-ingredient text-red-500 hover:text-red-700">
              <i class="fas fa-times-circle"></i>
            </button>
          </div>
        `;
        
        document.getElementById('stepsList').innerHTML = `
          <div class="step-item flex gap-2">
            <span class="step-number w-8 h-8 bg-pink-100 rounded-full flex items-center justify-center text-pink-700 font-medium">1</span>
            <textarea class="step-description flex-grow px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300" 
              placeholder="Instrucción" rows="2"></textarea>
          </div>
        `;
        
        // Show modal
        recipeFormModal.classList.add('show');
      });
      
      // Close modals
      closeModalButtons.forEach(button => {
        button.addEventListener('click', () => {
          const modal = button.closest('.modal');
          modal.classList.remove('show');
        });
      });
      
      // Add ingredient
      let lastSelectedUnit = 'g'; // Default unit

      document.getElementById('addIngredientBtn').addEventListener('click', () => {
        const ingredientsList = document.getElementById('ingredientsList');
        const newIngredient = document.createElement('div');
        newIngredient.className = 'ingredient-item flex gap-2';
        newIngredient.innerHTML = `
          <input type="text" class="ingredient-name flex-grow px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300" 
            placeholder="Ingrediente">
          <div class="ingredient-amount-container flex items-center">
            <button type="button" class="decrease-amount px-2 py-1 bg-gray-100 rounded-l-lg border border-gray-200">
              <i class="fas fa-minus"></i>
            </button>
            <input type="number" min="0" step="1" class="ingredient-amount w-16 px-2 py-2 border-y border-gray-200 text-center focus:outline-none focus:border-pink-300" 
              placeholder="Cant." value="1">
            <button type="button" class="increase-amount px-2 py-1 bg-gray-100 rounded-r-lg border border-gray-200">
              <i class="fas fa-plus"></i>
            </button>
          </div>
          <select class="ingredient-unit px-2 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300">
            <option value="g" ${lastSelectedUnit==='g'?'selected':''}>g</option>
            <option value="ml" ${lastSelectedUnit==='ml'?'selected':''}>ml</option>
            <option value="cda" ${lastSelectedUnit==='cda'?'selected':''}>cda</option>
            <option value="cdta" ${lastSelectedUnit==='cdta'?'selected':''}>cdta</option>
            <option value="unidades" ${lastSelectedUnit==='unidades'?'selected':''}>unidades</option>
            <option value="tazas" ${lastSelectedUnit==='tazas'?'selected':''}>tazas</option>
            <option value="pizca" ${lastSelectedUnit==='pizca'?'selected':''}>pizca</option>
          </select>
          <button type="button" class="remove-ingredient text-red-500 hover:text-red-700">
            <i class="fas fa-times-circle"></i>
          </button>
        `;
        ingredientsList.appendChild(newIngredient);

        // Add remove functionality
        newIngredient.querySelector('.remove-ingredient').addEventListener('click', function() {
          this.closest('.ingredient-item').remove();
        });

        // Unidad predeterminada
        const unitSelect = newIngredient.querySelector('.ingredient-unit');
        unitSelect.value = lastSelectedUnit;
        unitSelect.addEventListener('change', function() {
          lastSelectedUnit = this.value;
        });

        // Sumar/restar cantidad según unidad
        const amountInput = newIngredient.querySelector('.ingredient-amount');
        const decreaseBtn = newIngredient.querySelector('.decrease-amount');
        const increaseBtn = newIngredient.querySelector('.increase-amount');

        function getStep(unit) {
          if (unit === 'ml' || unit === 'g') return 10;
          if (unit === 'unidades') return 1;
          if (unit === 'cda' || unit === 'cdta' || unit === 'tazas') return 1;
          return 1;
        }

        function changeAmount(delta) {
          let value = parseInt(amountInput.value) || 0;
          const step = getStep(unitSelect.value);
          value += delta * step;
          if (value < 0) value = 0;
          amountInput.value = value;
        }

        let interval;
        function startChange(delta) {
          changeAmount(delta);
          interval = setInterval(() => changeAmount(delta), 150);
        }
        function stopChange() {
          clearInterval(interval);
        }

        decreaseBtn.addEventListener('mousedown', () => startChange(-1));
        decreaseBtn.addEventListener('mouseup', stopChange);
        decreaseBtn.addEventListener('mouseleave', stopChange);
        decreaseBtn.addEventListener('click', () => changeAmount(-1));

        increaseBtn.addEventListener('mousedown', () => startChange(1));
        increaseBtn.addEventListener('mouseup', stopChange);
        increaseBtn.addEventListener('mouseleave', stopChange);
        increaseBtn.addEventListener('click', () => changeAmount(1));
      });
      
      // Add step
      document.getElementById('addStepBtn').addEventListener('click', () => {
        const stepsList = document.getElementById('stepsList');
        const newStep = document.createElement('div');
        newStep.className = 'step-item flex gap-2';
        
        // Calculate step number
        const stepNumber = stepsList.children.length + 1;
        
        newStep.innerHTML = `
          <span class="step-number w-8 h-8 bg-pink-100 rounded-full flex items-center justify-center text-pink-700 font-medium">${stepNumber}</span>
          <textarea class="step-description flex-grow px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300" 
            placeholder="Instrucción" rows="2"></textarea>
          <button type="button" class="remove-step text-red-500 hover:text-red-700">
            <i class="fas fa-times-circle"></i>
          </button>
        `;
        stepsList.appendChild(newStep);
        
        // Add remove functionality
        newStep.querySelector('.remove-step').addEventListener('click', function() {
          this.closest('.step-item').remove();
          // Renumber steps
          document.querySelectorAll('.step-number').forEach((span, index) => {
            span.textContent = index + 1;
          });
        });
      });
      
      // Save recipe
      recipeForm.addEventListener('submit', function(e) {
        e.preventDefault();

        // Gather form data
        const recipeId = document.getElementById('recipeId').value || Date.now().toString();
        const name = document.getElementById('recipeName').value;
        // Split categories by comma, trim, and store as array
        const categoryInput = document.getElementById('recipeCategory').value;
        const categories = categoryInput.split(',').map(c => c.trim()).filter(Boolean);
        const description = document.getElementById('recipeDescription').value;
        const image = document.getElementById('recipeImage').value || 'https://cdn.pixabay.com/photo/2016/11/29/11/38/cake-1869227_960_720.jpg';

        // Get time based on selected option
        let time;
        if (exactTimeOption.checked) {
          time = {
            type: 'exact',
            value: document.getElementById('recipeTime').value
          };
        } else {
          time = {
            type: 'range',
            min: document.getElementById('recipeTimeMin').value,
            max: document.getElementById('recipeTimeMax').value
          };
        }
        
        // Get ingredients
        const ingredients = [];
        document.querySelectorAll('.ingredient-item').forEach(item => {
          const name = item.querySelector('.ingredient-name').value;
          const amount = item.querySelector('.ingredient-amount').value;
          const unit = item.querySelector('.ingredient-unit').value;
          if (name) {
            ingredients.push({ name, amount, unit });
          }
        });
        
        // Get steps
        const steps = [];
        document.querySelectorAll('.step-item').forEach(item => {
          const description = item.querySelector('.step-description').value;
          if (description) {
            steps.push(description);
          }
        });
        
        // Create recipe object
        const recipe = {
          id: recipeId,
          name,
          categories, // now array
          description,
          image,
          time,
          ingredients,
          steps,
          createdAt: new Date().toISOString()
        };
        
        // Add or update recipe
        const existingIndex = recipes.findIndex(r => r.id === recipeId);
        if (existingIndex >= 0) {
          recipes[existingIndex] = recipe;
        } else {
          recipes.push(recipe);
        }
        
        // Save to localStorage
        localStorage.setItem('recipes', JSON.stringify(recipes));
        
        // Update UI
        renderRecipes();
        
        // Close modal
        recipeFormModal.classList.remove('show');
      });
      
      // Al editar receta, soportar categorías y unidades
      function setupEditButtons() {
        document.querySelectorAll('.edit-recipe-btn').forEach(button => {
          button.addEventListener('click', function() {
            const recipeId = this.getAttribute('data-id');
            const recipe = recipes.find(r => r.id === recipeId);
            if (!recipe) return;
            document.getElementById('recipeFormTitle').textContent = 'Editar Receta';
            document.getElementById('recipeId').value = recipe.id;
            document.getElementById('recipeName').value = recipe.name;
            document.getElementById('recipeCategory').value = (recipe.categories||[]).join(', ');
            document.getElementById('recipeDescription').value = recipe.description;
            document.getElementById('recipeImage').value = recipe.image;
            // Set time values
            if (recipe.time) {
              if (recipe.time.type === 'exact') {
                exactTimeOption.checked = true;
                exactTimeContainer.classList.remove('hidden');
                rangeTimeContainer.classList.add('hidden');
                document.getElementById('recipeTime').value = recipe.time.value;
              } else {
                rangeTimeOption.checked = true;
                exactTimeContainer.classList.add('hidden');
                rangeTimeContainer.classList.remove('hidden');
                document.getElementById('recipeTimeMin').value = recipe.time.min;
                document.getElementById('recipeTimeMax').value = recipe.time.max;
              }
            }
            // Set ingredients
            const ingredientsList = document.getElementById('ingredientsList');
            ingredientsList.innerHTML = '';
            (recipe.ingredients||[]).forEach(ingredient => {
              const ingredientItem = document.createElement('div');
              ingredientItem.className = 'ingredient-item flex gap-2';
              ingredientItem.innerHTML = `
                <input type="text" class="ingredient-name flex-grow px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300" 
                  placeholder="Ingrediente" value="${ingredient.name}">
                <div class="ingredient-amount-container flex items-center">
                  <button type="button" class="decrease-amount px-2 py-1 bg-gray-100 rounded-l-lg border border-gray-200">
                    <i class="fas fa-minus"></i>
                  </button>
                  <input type="number" min="0" step="1" class="ingredient-amount w-16 px-2 py-2 border-y border-gray-200 text-center focus:outline-none focus:border-pink-300" 
                    placeholder="Cant." value="${ingredient.amount}">
                  <button type="button" class="increase-amount px-2 py-1 bg-gray-100 rounded-r-lg border border-gray-200">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
                <select class="ingredient-unit px-2 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300">
                  <option value="g">g</option>
                  <option value="ml">ml</option>
                  <option value="cda">cda</option>
                  <option value="cdta">cdta</option>
                  <option value="unidades">unidades</option>
                  <option value="tazas">tazas</option>
                  <option value="pizca">pizca</option>
                </select>
                <button type="button" class="remove-ingredient text-red-500 hover:text-red-700">
                  <i class="fas fa-times-circle"></i>
                </button>
              `;
              ingredientsList.appendChild(ingredientItem);
              // Unidad predeterminada
              const unitSelect = ingredientItem.querySelector('.ingredient-unit');
              unitSelect.value = ingredient.unit || 'g';
              unitSelect.addEventListener('change', function() {
                lastSelectedUnit = this.value;
              });
              // Sumar/restar cantidad según unidad
              const amountInput = ingredientItem.querySelector('.ingredient-amount');
              const decreaseBtn = ingredientItem.querySelector('.decrease-amount');
              const increaseBtn = ingredientItem.querySelector('.increase-amount');
              function getStep(unit) {
                if (unit === 'ml' || unit === 'g') return 10;
                if (unit === 'unidades') return 1;
                if (unit === 'cda' || unit === 'cdta' || unit === 'tazas') return 1;
                return 1;
              }
              function changeAmount(delta) {
                let value = parseInt(amountInput.value) || 0;
                const step = getStep(unitSelect.value);
                value += delta * step;
                if (value < 0) value = 0;
                amountInput.value = value;
              }
              let interval;
              function startChange(delta) {
                changeAmount(delta);
                interval = setInterval(() => changeAmount(delta), 150);
              }
              function stopChange() {
                clearInterval(interval);
              }
              decreaseBtn.addEventListener('mousedown', () => startChange(-1));
              decreaseBtn.addEventListener('mouseup', stopChange);
              decreaseBtn.addEventListener('mouseleave', stopChange);
              decreaseBtn.addEventListener('click', () => changeAmount(-1));
              increaseBtn.addEventListener('mousedown', () => startChange(1));
              increaseBtn.addEventListener('mouseup', stopChange);
              increaseBtn.addEventListener('mouseleave', stopChange);
              increaseBtn.addEventListener('click', () => changeAmount(1));
              // Remove
              ingredientItem.querySelector('.remove-ingredient').addEventListener('click', function() {
                this.closest('.ingredient-item').remove();
              });
            });
            // Set steps
            const stepsList = document.getElementById('stepsList');
            stepsList.innerHTML = '';
            (recipe.steps||[]).forEach((step, index) => {
              const stepItem = document.createElement('div');
              stepItem.className = 'step-item flex gap-2';
              stepItem.innerHTML = `
                <span class="step-number w-8 h-8 bg-pink-100 rounded-full flex items-center justify-center text-pink-700 font-medium">${index + 1}</span>
                <textarea class="step-description flex-grow px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-pink-300" 
                  placeholder="Instrucción" rows="2">${step}</textarea>
                <button type="button" class="remove-step text-red-500 hover:text-red-700">
                  <i class="fas fa-times-circle"></i>
                </button>
              `;
              stepsList.appendChild(stepItem);
              stepItem.querySelector('.remove-step').addEventListener('click', function() {
                this.closest('.step-item').remove();
                document.querySelectorAll('.step-number').forEach((span, idx) => {
                  span.textContent = idx + 1;
                });
              });
            });
            recipeFormModal.classList.add('show');
          });
        });
      }
      
      // Delete recipe
      function setupDeleteButtons() {
        document.querySelectorAll('.delete-recipe-btn').forEach(button => {
          button.addEventListener('click', function() {
            if (confirm('¿Estás seguro de que deseas eliminar esta receta?')) {
              const recipeId = this.getAttribute('data-id');
              recipes = recipes.filter(r => r.id !== recipeId);
              localStorage.setItem('recipes', JSON.stringify(recipes));
              renderRecipes();
            }
          });
        });
      }
      
      // Vista simplificada de receta (modal)
      let recipeViewModal;
      if (!document.getElementById('recipeViewModal')) {
        recipeViewModal = document.createElement('div');
        recipeViewModal.id = 'recipeViewModal';
        recipeViewModal.className = 'modal';
        recipeViewModal.innerHTML = `
          <div class="modal-content w-full max-w-lg p-6">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-bold" id="recipeViewTitle"></h3>
              <button class="close-modal text-gray-500 hover:text-gray-700"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div id="recipeViewBody"></div>
          </div>
        `;
        document.body.appendChild(recipeViewModal);
        recipeViewModal.querySelector('.close-modal').addEventListener('click', () => recipeViewModal.classList.remove('show'));
      }

      function setupViewButtons() {
        document.querySelectorAll('.view-recipe-btn').forEach(button => {
          button.addEventListener('click', function() {
            const recipeId = this.getAttribute('data-id');
            const recipe = recipes.find(r => r.id === recipeId);
            if (!recipe) return;
            document.getElementById('recipeViewTitle').textContent = recipe.name;
            let html = '';
            html += `<div class='mb-4'><strong>Ingredientes:</strong><ul class='list-disc pl-6'>`;
            (recipe.ingredients||[]).forEach(ing => {
              html += `<li>${ing.amount} ${ing.unit||''} ${ing.name}</li>`;
            });
            html += '</ul></div>';
            html += `<div class='mb-4'><strong>Pasos:</strong><ol class='list-decimal pl-6'>`;
            (recipe.steps||[]).forEach(step => {
              html += `<li>${step}</li>`;
            });
            html += '</ol></div>';
            recipeViewModal.querySelector('#recipeViewBody').innerHTML = html;
            recipeViewModal.classList.add('show');
          });
        });
      }
      
      // Render recipes
      function renderRecipes() {
        recipesGrid.innerHTML = '';

        // Actualizar filtro de categorías dinámicamente
        const categoryFilter = document.getElementById('categoryFilter');
        // Obtener todas las categorías únicas
        let allCategories = [];
        recipes.forEach(r => {
          if (Array.isArray(r.categories)) {
            allCategories = allCategories.concat(r.categories);
          } else if (r.category) {
            allCategories = allCategories.concat(r.category.split(',').map(c => c.trim()));
          }
        });
        allCategories = Array.from(new Set(allCategories.filter(Boolean)));
        categoryFilter.innerHTML = '<option value="">Todas las categorías</option>' +
          allCategories.map(cat => `<option value="${cat}">${cat.charAt(0).toUpperCase() + cat.slice(1)}</option>`).join('');

        if (recipes.length === 0) {
          recipesGrid.innerHTML = `
            <div class="col-span-full text-center py-8">
              <div class="text-gray-400 text-lg mb-3"><i class="fas fa-book fa-3x mb-3"></i></div>
              <h3 class="text-xl font-medium mb-2">Aún no tienes recetas</h3>
              <p class="text-gray-500 mb-4">¡Comienza a añadir tus recetas favoritas!</p>
              <button id="emptyAddRecipeBtn" class="btn btn-primary">
                <i class="fas fa-plus mr-2"></i> Añadir receta
              </button>
            </div>
          `;
          document.getElementById('emptyAddRecipeBtn').addEventListener('click', function() {
            addRecipeBtn.click();
          });
          return;
        }

        // Filtro de búsqueda y categoría
        const searchValue = document.getElementById('recipeSearch').value.toLowerCase();
        const selectedCategory = categoryFilter.value;

        let filteredRecipes = recipes.filter(recipe => {
          // Filtro por búsqueda (nombre o ingrediente)
          const nameMatch = recipe.name.toLowerCase().includes(searchValue);
          const ingredientMatch = recipe.ingredients && recipe.ingredients.some(ing => ing.name.toLowerCase().includes(searchValue));
          // Filtro por categoría
          let categoryMatch = true;
          if (selectedCategory) {
            if (Array.isArray(recipe.categories)) {
              categoryMatch = recipe.categories.includes(selectedCategory);
            } else if (recipe.category) {
              categoryMatch = recipe.category.split(',').map(c => c.trim()).includes(selectedCategory);
            }
          }
          return (nameMatch || ingredientMatch) && categoryMatch;
        });

        if (filteredRecipes.length === 0) {
          recipesGrid.innerHTML = `<div class="col-span-full text-center py-8 text-gray-400">No se encontraron recetas.</div>`;
          return;
        }

        filteredRecipes.forEach(recipe => {
          let timeDisplay = 'N/A';
          if (recipe.time) {
            timeDisplay = recipe.time.type === 'exact' 
              ? `${recipe.time.value} min` 
              : `${recipe.time.min}-${recipe.time.max} min`;
          }
          const recipeCard = document.createElement('div');
          recipeCard.className = 'recipe-card card';
          recipeCard.innerHTML = `
            <img src="${recipe.image}" alt="${recipe.name}" class="w-full recipe-thumb">
            <div class="p-4">
              <div class="flex justify-between items-start mb-2">
                <h3 class="font-bold text-lg">${recipe.name}</h3>
                <div class="flex gap-1">
                  ${(recipe.categories||[]).map(cat => `<span class='badge badge-primary'>${cat}</span>`).join('')}
                </div>
              </div>
              <p class="text-gray-600 mb-3 text-sm">${recipe.description}</p>
              <div class="flex justify-between items-center">
                <div class="flex items-center text-sm text-gray-500">
                  <i class="fas fa-clock mr-1"></i>
                  <span>${timeDisplay}</span>
                </div>
                <div class="flex gap-2">
                  <button class="p-2 hover:bg-gray-100 rounded-full edit-recipe-btn" data-id="${recipe.id}">
                    <i class="fas fa-pencil"></i>
                  </button>
                  <button class="p-2 hover:bg-gray-100 rounded-full delete-recipe-btn" data-id="${recipe.id}">
                    <i class="fas fa-trash"></i>
                  </button>
                  <button class="p-2 hover:bg-pink-100 rounded-full view-recipe-btn" data-id="${recipe.id}">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </div>
            </div>
          `;
          recipesGrid.appendChild(recipeCard);
        });
        
        setupEditButtons();
        setupDeleteButtons();
        setupViewButtons();
      }
      
      // Filtros y búsqueda en tiempo real
      categoryFilter.addEventListener('change', renderRecipes);
      document.getElementById('recipeSearch').addEventListener('input', renderRecipes);
      
      // Save all data functionality
      document.getElementById('saveAllDataBtn').addEventListener('click', function() {
        localStorage.setItem('recipes', JSON.stringify(recipes));
        localStorage.setItem('gallery', JSON.stringify(gallery));
        localStorage.setItem('wishlist', JSON.stringify(wishlist));
        
        // Show save confirmation
        alert('Todos los datos han sido guardados correctamente');
      });
      
      // Inicializar galería
      function renderGallery() {
        galleryGrid.innerHTML = '';
        let visibleGallery = gallery.filter(item => item.visible !== false);
        if (visibleGallery.length === 0) {
          galleryGrid.innerHTML = `<div class='col-span-full text-center text-gray-400 py-8'>No hay fotos en la galería.</div>`;
          return;
        }
        visibleGallery.forEach(item => {
          const card = document.createElement('div');
          card.className = 'gallery-item card';
          card.innerHTML = `
            <img src="${item.url}" alt="${item.title}" class="w-full gallery-thumb">
            <div class="p-3">
              <div class="flex justify-between items-center mb-1">
                <h4 class="font-bold">${item.title}</h4>
                <button class="delete-photo-btn text-red-400 hover:text-red-600" data-id="${item.id}"><i class="fas fa-trash"></i></button>
              </div>
              <p class="text-xs text-gray-500 mb-1">${item.description}</p>
              <div class="text-xs text-gray-400">Subida: ${new Date(item.createdAt).toLocaleDateString()}</div>
            </div>
          `;
          card.querySelector('.delete-photo-btn').addEventListener('click', function() {
            if (confirm('¿Eliminar esta foto de la galería?')) {
              const id = this.getAttribute('data-id');
              const idx = gallery.findIndex(g => g.id === id);
              if (idx >= 0) {
                gallery.splice(idx, 1);
                localStorage.setItem('gallery', JSON.stringify(gallery));
                renderGallery();
              }
            }
          });
          galleryGrid.appendChild(card);
        });
      }
      
      // Galería de fotos
      const galleryGrid = document.getElementById('galleryGrid');
      const addPhotoBtn = document.getElementById('addPhotoBtn');
      const photoFormModal = document.getElementById('photoFormModal');
      const photoForm = document.getElementById('photoForm');

      addPhotoBtn.addEventListener('click', () => {
        photoForm.reset();
        photoFormModal.classList.add('show');
      });

      document.querySelectorAll('#photoFormModal .close-modal').forEach(btn => {
        btn.addEventListener('click', () => photoFormModal.classList.remove('show'));
      });

      photoForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const title = document.getElementById('photoTitle').value;
        const description = document.getElementById('photoDescription').value;
        const url = document.getElementById('photoURL').value;
        const createdAt = new Date().toISOString();
        gallery.push({ id: Date.now().toString(), title, description, url, createdAt, visible: true });
        localStorage.setItem('gallery', JSON.stringify(gallery));
        renderGallery();
        photoFormModal.classList.remove('show');
      });
      
      // Lista de deseos
      const addWishBtn = document.getElementById('addWishBtn');
      const wishFormModal = document.getElementById('wishFormModal');
      const wishForm = document.getElementById('wishForm');

      addWishBtn.addEventListener('click', () => {
        wishForm.reset();
        wishFormModal.classList.add('show');
      });

      document.querySelectorAll('#wishFormModal .close-modal').forEach(btn => {
        btn.addEventListener('click', () => wishFormModal.classList.remove('show'));
      });

      wishForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const category = document.getElementById('wishCategory').value;
        const title = document.getElementById('wishTitle').value;
        const notes = document.getElementById('wishNotes').value;
        const wish = { id: Date.now().toString(), title, notes, completed: false };
        wishlist[category].unshift(wish);
        localStorage.setItem('wishlist', JSON.stringify(wishlist));
        renderWishlist();
        wishFormModal.classList.remove('show');
      });

      function renderWishlist() {
        ['cook','restaurant','ingredients'].forEach(cat => {
          const container = document.getElementById('wishlist-' + cat);
          if (!container) return;
          container.innerHTML = '';
          let wishes = wishlist[cat] || [];
          // Mostrar solo los no completados primero, luego los completados (máx 5 visibles completados)
          const notCompleted = wishes.filter(w => !w.completed);
          const completed = wishes.filter(w => w.completed).slice(0, 5);
          notCompleted.concat(completed).forEach(wish => {
            const item = document.createElement('div');
            item.className = 'wishlist-item p-3 flex items-center gap-3' + (wish.completed ? ' completed-item' : '');
            item.innerHTML = `
              <input type="checkbox" class="wishlist-checkbox" ${wish.completed ? 'checked' : ''}>
              <div>
                <h4 class="font-medium">${wish.title}</h4>
                <p class="text-sm text-gray-500">${wish.notes}</p>
              </div>
              <button class="remove-wish-btn ml-auto text-red-400 hover:text-red-600"><i class="fas fa-trash"></i></button>
            `;
            // Tachar al completar
            item.querySelector('.wishlist-checkbox').addEventListener('change', function() {
              wish.completed = this.checked;
              localStorage.setItem('wishlist', JSON.stringify(wishlist));
              renderWishlist();
            });
            // Eliminar deseo
            item.querySelector('.remove-wish-btn').addEventListener('click', function() {
              if (confirm('¿Eliminar este deseo?')) {
                wishlist[cat] = wishlist[cat].filter(w => w.id !== wish.id);
                localStorage.setItem('wishlist', JSON.stringify(wishlist));
                renderWishlist();
              }
            });
            container.appendChild(item);
          });
          // Si hay más completados, mostrar botón para ver más
          if (wishes.filter(w => w.completed).length > 5) {
            const btn = document.createElement('button');
            btn.className = 'text-xs text-pink-500 hover:underline mt-2';
            btn.textContent = 'Mostrar todos los completados';
            btn.addEventListener('click', function() {
              wishlist[cat].forEach(w => w.showAll = true);
              container.innerHTML = '';
              wishes.forEach(wish => {
                const item = document.createElement('div');
                item.className = 'wishlist-item p-3 flex items-center gap-3' + (wish.completed ? ' completed-item' : '');
                item.innerHTML = `
                  <input type="checkbox" class="wishlist-checkbox" ${wish.completed ? 'checked' : ''}>
                  <div>
                    <h4 class="font-medium">${wish.title}</h4>
                    <p class="text-sm text-gray-500">${wish.notes}</p>
                  </div>
                  <button class="remove-wish-btn ml-auto text-red-400 hover:text-red-600"><i class="fas fa-trash"></i></button>
                `;
                item.querySelector('.wishlist-checkbox').addEventListener('change', function() {
                  wish.completed = this.checked;
                  localStorage.setItem('wishlist', JSON.stringify(wishlist));
                  renderWishlist();
                });
                item.querySelector('.remove-wish-btn').addEventListener('click', function() {
                  if (confirm('¿Eliminar este deseo?')) {
                    wishlist[cat] = wishlist[cat].filter(w => w.id !== wish.id);
                    localStorage.setItem('wishlist', JSON.stringify(wishlist));
                    renderWishlist();
                  }
                });
                container.appendChild(item);
              });
            });
            container.appendChild(btn);
          }
        });
      }
      
      // Inicializar deseos
      renderWishlist();
      
      // Dark mode toggle functionality
      const darkModeToggle = document.getElementById('darkModeToggle');
      const body = document.body;
      const isDarkMode = localStorage.getItem('darkMode') === 'true';
      
      if (isDarkMode) {
        body.classList.add('dark-mode');
        darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
      }
      
      darkModeToggle.addEventListener('click', () => {
        body.classList.toggle('dark-mode');
        const isDark = body.classList.contains('dark-mode');
        localStorage.setItem('darkMode', isDark);
        darkModeToggle.innerHTML = isDark 
          ? '<i class="fas fa-sun"></i>' 
          : '<i class="fas fa-moon"></i>';
      });
    });
  </script>
</body>
</html>